language: node_js

node_js:
  - '10'

os:
  - linux

cache: npm

branches:
  only:
    - master

install:
  - npm install -g vsce
  - npm install

script:
  - vsce package

before_deploy:
  - export VERSION_TAG=v$(node -p -e "require('./package.json').version")
  - echo "Tagging $VERSION_TAG"

deploy:
  provider: releases
  on:
    tags: true
  file: "*.vsix"
  api_key: $GITHUB_API_KEY
  file_glob: true
  skip_cleanup: true
  overwrite: true